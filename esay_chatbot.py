# -*- coding: utf-8 -*-
"""esay chatbot.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/16DcWE294q-qLfNQKZOYacBzCXR3-d8KR
"""

!pip install openai gradio --quiet

import os
import gradio as gr
from openai import OpenAI

os.environ["OPENAI_API_KEY"] = "Your Key "

user_state = {"step": None, "service": None}

def chatbot_logic(message, history):
    global user_state

    if len(history) == 0:
        user_state["step"] = "ask_name"
        return "Ø£Ù‡Ù„Ø§Ù‹ ğŸ‘‹ØŒ ØªÙ‚Ø¯Ø± ØªØ¹Ø±ÙÙ†ÙŠ Ø¨Ø§Ø³Ù…ÙƒØŸ"

    if user_state["step"] == "ask_name":
        user_state["step"] = "choose_service"
        return f"Ø­ÙŠØ§Ùƒ Ø§Ù„Ù„Ù‡ {message} ğŸŒ¹ØŒ Ù…Ø¹Ø§Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø³Ø§Ø±Ø©.\n\nØ§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©:\n- Ø±ÙØ¹ Ø´ÙƒÙˆÙ‰\n- Ø·Ù„Ø¨ Ù…ÙˆØ¹Ø¯\n- Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù†ØªØ§Ø¦Ø¬\n\nØ§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù„ÙŠ ØªØ¨ÙŠÙ‡Ø§."

    if user_state["step"] == "choose_service":
        if "Ø´ÙƒÙˆÙ‰" in message:
            user_state["service"] = "complaint"
            user_state["step"] = "ask_complaint"
            return "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© Ø±ÙØ¹ Ø´ÙƒÙˆÙ‰ âœ….\n\nÙ…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø´ÙƒÙˆÙ‰."
        elif "Ù…ÙˆØ¹Ø¯" in message:
            user_state["service"] = "appointment"
            user_state["step"] = "ask_phone"
            return "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© Ø·Ù„Ø¨ Ù…ÙˆØ¹Ø¯ âœ….\n\nÙ…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„Ùƒ."
        elif "Ø§Ø³ØªÙØ³Ø§Ø±" in message:
            user_state["service"] = "inquiry"
            user_state["step"] = "ask_ticket"
            return "ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„Ù†ØªØ§Ø¦Ø¬ âœ….\n\nÙ…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©."
        else:
            return "Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø®Ø¯Ù…Ø© ØµØ­ÙŠØ­Ø©: Ø±ÙØ¹ Ø´ÙƒÙˆÙ‰ / Ø·Ù„Ø¨ Ù…ÙˆØ¹Ø¯ / Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù†ØªØ§Ø¦Ø¬."

    if user_state["service"] == "complaint":
        if user_state["step"] == "ask_complaint":
            ticket = random.randint(1000, 9999)
            user_state["step"] = "done"
            return f"Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ğŸ™ ØªÙ… Ø±ÙØ¹ Ø§Ù„Ø´ÙƒÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­.\nØ±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø©: #{ticket}"

    if user_state["service"] == "appointment":
        if user_state["step"] == "ask_phone":
            user_state["step"] = "ask_date"
            return "ØªÙ… Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ âœ….\nØ§Ù„Ø¢Ù† Ù…Ù† ÙØ¶Ù„Ùƒ Ø­Ø¯Ø¯ Ø§Ù„ÙŠÙˆÙ… ÙˆØ§Ù„ÙˆÙ‚Øª."
        elif user_state["step"] == "ask_date":
            user_state["step"] = "done"
            return f"ØªÙ… Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯Ùƒ ÙÙŠ {message} âœ….\nØ³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù„Ù„ØªØ£ÙƒÙŠØ¯ØŒ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ğŸŒ¹."

    if user_state["service"] == "inquiry":
        if user_state["step"] == "ask_ticket":
            user_state["step"] = "ask_email"
            return "ØªÙ… Ø­ÙØ¸ Ø±Ù‚Ù… Ø§Ù„ØªØ°ÙƒØ±Ø© âœ….\nØ§Ù„Ø¢Ù† Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ."
        elif user_state["step"] == "ask_email":
            user_state["step"] = "done"
            return "âœ… Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ Ø³Ø§Ø¹ØªÙŠÙ† Ø¹Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ.\nØ´ÙƒØ±Ø§Ù‹ Ù„ØªÙˆØ§ØµÙ„Ùƒ Ù…Ø¹Ù†Ø§ ğŸŒ¹."

    if user_state["step"] == "done":
        return "Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù†ØªÙ‡Øª âœ….\nØ¥Ø°Ø§ Ø­Ø§Ø¨ ØªØ¨Ø¯Ø£ Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø§ÙƒØªØ¨ Ø£ÙŠ ÙƒÙ„Ù…Ø©."

    return "Ù…Ù…ÙƒÙ† ØªØ®ØªØ§Ø± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©: Ø±ÙØ¹ Ø´ÙƒÙˆÙ‰ / Ø·Ù„Ø¨ Ù…ÙˆØ¹Ø¯ / Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ù†ØªØ§Ø¦Ø¬."

with gr.Blocks() as demo:
    gr.Markdown("# ğŸ¤– Chatbot: Appointment Assistant")
    gr.ChatInterface(fn=chatbot_logic)

demo.launch()